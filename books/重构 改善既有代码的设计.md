# 重构 改善既有代码的设计

懒惰是程序猿的美德之一，绝不要因为这本书就让你变得勤快。

## 前言

>以重构方式改进软件质量

1. 什么是重构？

所谓重构(Refactoring)是在不改变代码外在行为的前提下，对代码做出修改，以改进程序的内部结构。本质上说，重构就是在代码写好之后改进它的设计。

2. 本书有什么？

本书是一本为专业程序猿而写的重构指南。我的目的是告诉你如何以一种可控制且高效率的方式进行重构。你将学会如何有条不紊的改进程序结构，而且不会引入错误，这就是正确的重构方式。

本书全部都是使用java撰写，Java是一种面向对象语言，面向对象机制对于重构有很大的帮助。

## 第一章 - 重构，第一个案列

>如果发现自己需要为程序添加一个特性，而代码结构是你无法很方便地达成目的，那就先重构那个程序，使特性的添加比较容易进行，然后再添加特性。

1.2 重构的第一步

重构的第一个步骤永远相同:为即将修改的代码建立一组可靠的测试环境。好的测试是重构的根本。花时间建立一个优良的测试机制是完全值得的，因为当你修改程序时，好测试会给你必要的安全保障。

>重构前，先检查自己是否有一套可靠的测试机制。这些测试必须有自我检验能力。

>重构技术就是以微小的步伐修改程序。当你犯下错误时，很容易便可以发现它。

>任何一个傻瓜都能写出计算机可以理解的代码，唯有写出人类容易理解的代码，才是优秀的程序员。




## 第二章 重构原则

>重构(名词)：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。

>重构(动词)：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。

**三次法则**：

>事不过三，三则重构

1. 添加功能时重构
2. 修改错误时重构
3. 复审代码时重构

是什么让程序变得如此难以相与？眼下我能想起下述四个原因，它们是：

+	难以阅读的程序，难以修改；
+	逻辑重复的程序，难以修改；
+	添加新行为时需要修改已有代码的程序，难以修改；
+	带复杂条件逻辑的程序，难以修改；

因此，我们希望程序：

1. 容易阅读；
2. 所有逻辑都只在唯一地方指定；
3. 新的改动不会危及现有行为；
4. 尽可能简单表达条件逻辑。


“计算机科学是这样一门科学：它相信所有问题都可以通过增加一个间接层来解决。”--Ken Beck

间接层的某些价值：

+	允许逻辑共享
+	分开解释意图和实现
+	隔离变化
+	封装条件逻辑





## 第三章 代码的坏味道

1.重复代码 (Duplicated Code)

提炼出重复的代码，然后让两个地点都调用被提炼出来的那一段代码。

2.过长函数 (Long Method)

>拥有短函数的对象会活得比较好、比较长

间接层带来的全部利益 --- 解释能力、共享能力、选择能力 --- 都是有小型函数支持的。但是让小函数容易理解的**真正关键在于一个好名字**。便于读者可以通过名字了解函数的作用，而不用去看函数中写了什么。

我们遵循这样一条原则：`每当感觉需要注释来说明点什么的时候，我们就把需要说明写进一个独立的函数中`

提炼的信号：a.寻找注释；b.条件表达式和循环。将他们都提炼到独立的函数中去。

3.过长的类 (Large Class)

如果类内数个变量有着相同的前缀或字尾，这就意味着有机会把它们提炼到某个组件内。

4.过长参数列 (Long Parameter List)

使用对象来传递数据。

5.发散式变化 (Divergent Change)

针对某一外界变化的所有相应修改，都应该只发生在单一类中，而这个新类内的所有都应该反应此变化。为此，你应该找出某特定原因而造成的所有变化，然后将它们提炼到另一个类中。

6.散弹式修改 (Shotgun Surgery)

发散式变化是指“一个类受多种变化影响”，散弹式修改是指“一种变化引发多各类相应修改”。这两种情况下你都会希望整理代码。使“外界变化”与“需要修改的类”趋于一一对应。

7. 依恋情节 (Feature Envy)


...



### 构筑测试体系



